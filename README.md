# åŸºäºŽBacktraderçš„å®Œæ•´å›žæµ‹æ¡†æž¶

ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„é‡åŒ–äº¤æ˜“å›žæµ‹æ¡†æž¶ï¼ŒåŸºäºŽBacktraderæž„å»ºï¼ŒåŒ…å«æ•°æ®å±‚ã€ç­–ç•¥é€»è¾‘å±‚ã€æ‰§è¡Œå±‚ã€é£Žé™©æŽ§åˆ¶å±‚å’Œè¯„ä¼°å±‚ã€‚

## ðŸš€ ä¸»è¦åŠŸèƒ½

### ðŸ“Š æ ¸å¿ƒåŠŸèƒ½
- **å®Œæ•´å›žæµ‹æ¡†æž¶**ï¼šåŸºäºŽBacktraderçš„å¤šå±‚æž¶æž„è®¾è®¡
- **æ•°æ®ç®¡ç†**ï¼šæ”¯æŒxtquantæ•°æ®æºï¼Œè‡ªåŠ¨æ•°æ®æ¸…æ´—å’Œæ ¼å¼åŒ–
- **ç­–ç•¥å¼€å‘**ï¼šæä¾›åŠ¨é‡ç­–ç•¥ç¤ºä¾‹ï¼Œæ”¯æŒè‡ªå®šä¹‰ç­–ç•¥å¼€å‘
- **é£Žé™©æŽ§åˆ¶**ï¼šå†…ç½®æ­¢æŸã€ä»“ä½é™åˆ¶ã€é£Žé™©æŒ‡æ ‡ç›‘æŽ§
- **äº¤æ˜“æˆæœ¬**ï¼šæ¨¡æ‹Ÿæ‰‹ç»­è´¹ã€æ»‘ç‚¹ç­‰çœŸå®žäº¤æ˜“æˆæœ¬
- **ç»©æ•ˆåˆ†æž**ï¼šå…¨é¢çš„å›žæµ‹ç»©æ•ˆæŒ‡æ ‡è®¡ç®—

### ðŸ“ˆ å¯è§†åŒ–åˆ†æž
- **å¤šå›¾è¡¨å±•ç¤º**ï¼šæ”¶ç›ŠçŽ‡æ›²çº¿ã€ä»“ä½å˜åŒ–ã€æ¯æ—¥ç›ˆäº
- **åŸºå‡†å¯¹æ¯”**ï¼šæ”¯æŒæ²ªæ·±300ç­‰åŸºå‡†æŒ‡æ•°å¯¹æ¯”
- **è¶…é¢æ”¶ç›Š**ï¼šè®¡ç®—å¹¶æ˜¾ç¤ºç­–ç•¥ç›¸å¯¹åŸºå‡†çš„è¶…é¢æ”¶ç›Š
- **HTMLæŠ¥å‘Š**ï¼šè‡ªåŠ¨ç”Ÿæˆç¾Žè§‚çš„HTMLç½‘é¡µæŠ¥å‘Š
- **è‡ªåŠ¨æ‰“å¼€**ï¼šå›žæµ‹å®ŒæˆåŽè‡ªåŠ¨åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æŠ¥å‘Š

### ðŸ”§ æŠ€æœ¯ç‰¹æ€§
- **é¢„çƒ­æœŸæœºåˆ¶**ï¼š20ä¸ªäº¤æ˜“æ—¥é¢„çƒ­æœŸï¼Œç¡®ä¿æŒ‡æ ‡è®¡ç®—ç¨³å®š
- **æ•°æ®å¯¹é½**ï¼šè‡ªåŠ¨å¤„ç†ç­–ç•¥æ•°æ®ä¸ŽåŸºå‡†æ•°æ®çš„æ—¶é—´å¯¹é½
- **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œæ—¥å¿—è®°å½•
- **æ¨¡å—åŒ–è®¾è®¡**ï¼šå„å±‚ç‹¬ç«‹ï¼Œä¾¿äºŽæ‰©å±•å’Œç»´æŠ¤

## ðŸ“ é¡¹ç›®ç»“æž„

```
Choose/
â”œâ”€â”€ backtest.py              # ä¸»å›žæµ‹æ¡†æž¶
â”œâ”€â”€ report.py                # HTMLæŠ¥å‘Šç”Ÿæˆæ¨¡å—
â”œâ”€â”€ plt_benchmark.py         # åŸºå‡†æ•°æ®å’Œå›¾è¡¨ç»˜åˆ¶æ¨¡å—
â”œâ”€â”€ backtest_results.json    # å›žæµ‹ç»“æžœJSONæ–‡ä»¶
â”œâ”€â”€ backtest_report.html     # HTMLæŠ¥å‘Šæ–‡ä»¶
â””â”€â”€ backtest_returns_curve.png # ç­–ç•¥è¡¨çŽ°å›¾è¡¨
```

## ðŸ› ï¸ å®‰è£…ä¾èµ–

```bash
pip install backtrader pandas numpy matplotlib xtquant
```

## ðŸ“– ä½¿ç”¨æŒ‡å—

### 1. åŸºæœ¬ä½¿ç”¨

```python
# ç›´æŽ¥è¿è¡Œå›žæµ‹
python Choose/backtest.py
```

### 2. è‡ªå®šä¹‰ç­–ç•¥

```python
from Choose.backtest import BacktestFramework, MomentumStrategy

# åˆ›å»ºå›žæµ‹æ¡†æž¶
framework = BacktestFramework(initial_cash=100000)

# è®¾ç½®å›žæµ‹å¼•æ“Ž
framework.setup_cerebro()

# æ·»åŠ æ•°æ®æº
framework.add_data(data_dict)

# æ·»åŠ è‡ªå®šä¹‰ç­–ç•¥
framework.add_strategy(
    MomentumStrategy,
    lookback_period=20,
    momentum_threshold=0.05,
    position_size=0.1,
    stop_loss=0.05,
    take_profit=0.15
)

# è¿è¡Œå›žæµ‹
strategy, metrics, analyzer_results = framework.run_backtest()
```

### 3. ç”ŸæˆHTMLæŠ¥å‘Š

```python
from Choose.report import generate_backtest_report

# ç”ŸæˆHTMLæŠ¥å‘Š
report_path = generate_backtest_report(
    strategy=strategy,
    initial_cash=100000,
    analyzer_results=analyzer_results,
    benchmark_dates=benchmark_dates,
    benchmark_curve=benchmark_curve,
    benchmark_name='æ²ªæ·±300åŸºå‡†',
    save_path='my_report.html',
    auto_open=True  # è‡ªåŠ¨æ‰“å¼€æŠ¥å‘Š
)
```

## ðŸ“Š å›žæµ‹æŠ¥å‘Šå†…å®¹

### åŸºç¡€ç»Ÿè®¡
- åˆå§‹èµ„é‡‘ã€æœ€ç»ˆèµ„äº§ã€æ€»æ”¶ç›ŠçŽ‡
- æ•°æ®ç‚¹æ•°é‡ã€å›žæµ‹å‘¨æœŸ

### é£Žé™©æŒ‡æ ‡
- æœ€å¤§å›žæ’¤åŠå›žæ’¤å¤©æ•°
- å¤æ™®æ¯”çŽ‡ã€å¹´åŒ–æ”¶ç›ŠçŽ‡
- é£Žé™©è°ƒæ•´åŽæ”¶ç›Š

### äº¤æ˜“ç»Ÿè®¡
- æ€»äº¤æ˜“æ¬¡æ•°ã€ç›ˆåˆ©/äºæŸäº¤æ˜“
- äº¤æ˜“èƒœçŽ‡ã€å¹³å‡ç›ˆäº
- ç›ˆäºæ¯”

### æ¯æ—¥ç›ˆäºç»Ÿè®¡
- æ€»ç›ˆäºã€ç›ˆåˆ©/äºæŸå¤©æ•°
- æœ€å¤§å•æ—¥ç›ˆåˆ©/äºæŸ
- å¹³å‡æ¯æ—¥ç›ˆäºã€æ—¥èƒœçŽ‡

### å¯è§†åŒ–å›¾è¡¨
- **æ”¶ç›ŠçŽ‡æ›²çº¿**ï¼šç­–ç•¥æ”¶ç›ŠçŽ‡ã€åŸºå‡†æ”¶ç›ŠçŽ‡ã€è¶…é¢æ”¶ç›Š
- **ä»“ä½å˜åŒ–**ï¼šæ¯æ—¥æŒä»“é‡‘é¢å˜åŒ–
- **æ¯æ—¥ç›ˆäº**ï¼šç»¿è‰²è¡¨ç¤ºç›ˆåˆ©ï¼Œçº¢è‰²è¡¨ç¤ºäºæŸ

## âš™ï¸ é…ç½®å‚æ•°

### ç­–ç•¥å‚æ•°
```python
params = (
    ('lookback_period', 20),      # å›žçœ‹å‘¨æœŸ
    ('momentum_threshold', 0.05), # åŠ¨é‡é˜ˆå€¼
    ('position_size', 0.1),       # ä»“ä½å¤§å°
    ('stop_loss', 0.05),          # æ­¢æŸæ¯”ä¾‹
    ('take_profit', 0.15),        # æ­¢ç›ˆæ¯”ä¾‹
)
```

### é£Žé™©æŽ§åˆ¶å‚æ•°
```python
risk_manager = RiskManager(
    max_position_pct=0.1,    # å•åªè‚¡ç¥¨æœ€å¤§ä»“ä½æ¯”ä¾‹
    stop_loss_pct=0.05,      # æ­¢æŸæ¯”ä¾‹
    max_drawdown_pct=0.2     # æœ€å¤§å›žæ’¤é™åˆ¶
)
```

### äº¤æ˜“æˆæœ¬å‚æ•°
```python
transaction_costs = TransactionCosts(
    commission_pct=0.0003,   # æ‰‹ç»­è´¹çŽ‡
    slippage_pct=0.0001,     # æ»‘ç‚¹çŽ‡
    min_trade_amount=1000    # æœ€å°äº¤æ˜“é‡‘é¢
)
```

## ðŸ“ˆ ç»©æ•ˆæŒ‡æ ‡è¯´æ˜Ž

### æ”¶ç›ŠçŽ‡æŒ‡æ ‡
- **æ€»æ”¶ç›ŠçŽ‡**ï¼šæ•´ä¸ªå›žæµ‹æœŸé—´çš„ç´¯è®¡æ”¶ç›ŠçŽ‡
- **å¹´åŒ–æ”¶ç›ŠçŽ‡**ï¼šæŒ‰å¹´åŒ–è®¡ç®—çš„æ”¶ç›ŠçŽ‡
- **è¶…é¢æ”¶ç›Š**ï¼šç­–ç•¥æ”¶ç›ŠçŽ‡å‡åŽ»åŸºå‡†æ”¶ç›ŠçŽ‡

### é£Žé™©æŒ‡æ ‡
- **æœ€å¤§å›žæ’¤**ï¼šä»Žå³°å€¼åˆ°è°·å€¼çš„æœ€å¤§è·Œå¹…
- **å¤æ™®æ¯”çŽ‡**ï¼šé£Žé™©è°ƒæ•´åŽæ”¶ç›ŠæŒ‡æ ‡
- **å›žæ’¤é•¿åº¦**ï¼šæœ€å¤§å›žæ’¤æŒç»­çš„å¤©æ•°

### äº¤æ˜“æŒ‡æ ‡
- **èƒœçŽ‡**ï¼šç›ˆåˆ©äº¤æ˜“å æ€»äº¤æ˜“çš„æ¯”ä¾‹
- **ç›ˆäºæ¯”**ï¼šå¹³å‡ç›ˆåˆ©ä¸Žå¹³å‡äºæŸçš„æ¯”å€¼
- **äº¤æ˜“é¢‘çŽ‡**ï¼šå•ä½æ—¶é—´å†…çš„äº¤æ˜“æ¬¡æ•°

## ðŸ”§ æ‰©å±•å¼€å‘

### æ·»åŠ æ–°ç­–ç•¥
```python
class MyStrategy(bt.Strategy):
    params = (
        ('param1', 10),
        ('param2', 0.1),
    )
    
    def __init__(self):
        # åˆå§‹åŒ–æŒ‡æ ‡
        self.sma = bt.indicators.SimpleMovingAverage(self.data.close, period=20)
    
    def next(self):
        # ç­–ç•¥é€»è¾‘
        if self.data.close[0] > self.sma[0]:
            self.buy()
        elif self.data.close[0] < self.sma[0]:
            self.sell()
```

### æ·»åŠ æ–°åˆ†æžå™¨
```python
# åœ¨add_analyzersæ–¹æ³•ä¸­æ·»åŠ 
self.cerebro.addanalyzer(bt.analyzers.SQN, _name='sqn')
```

### è‡ªå®šä¹‰æŠ¥å‘Š
```python
# ä¿®æ”¹report.pyä¸­çš„HTMLæ¨¡æ¿
# æˆ–åˆ›å»ºæ–°çš„æŠ¥å‘Šç”Ÿæˆå‡½æ•°
```

## ðŸ“ æ³¨æ„äº‹é¡¹

1. **æ•°æ®è´¨é‡**ï¼šç¡®ä¿è¾“å…¥æ•°æ®çš„å®Œæ•´æ€§å’Œå‡†ç¡®æ€§
2. **å‚æ•°è°ƒä¼˜**ï¼šæ ¹æ®å¸‚åœºæƒ…å†µè°ƒæ•´ç­–ç•¥å‚æ•°
3. **é£Žé™©æŽ§åˆ¶**ï¼šåˆç†è®¾ç½®æ­¢æŸå’Œä»“ä½é™åˆ¶
4. **å›žæµ‹å‘¨æœŸ**ï¼šé€‰æ‹©åˆé€‚çš„å›žæµ‹æ—¶é—´èŒƒå›´
5. **åŸºå‡†é€‰æ‹©**ï¼šé€‰æ‹©åˆé€‚çš„åŸºç¡€æŒ‡æ•°ä½œä¸ºå¯¹æ¯”

## ðŸ› å¸¸è§é—®é¢˜

### Q: å¤æ™®æ¯”çŽ‡ä¸ºè´Ÿå€¼ï¼Ÿ
A: è¿™æ˜¯æ­£å¸¸çš„ï¼Œè¡¨ç¤ºç­–ç•¥çš„é£Žé™©è°ƒæ•´åŽæ”¶ç›Šä¸ºè´Ÿï¼Œéœ€è¦ä¼˜åŒ–ç­–ç•¥å‚æ•°ã€‚

### Q: æœ€å¤§å›žæ’¤æ˜¾ç¤ºå¼‚å¸¸ï¼Ÿ
A: å·²ä¿®å¤æœ€å¤§å›žæ’¤çš„æ˜¾ç¤ºæ ¼å¼é—®é¢˜ï¼ŒçŽ°åœ¨ä¼šæ ¹æ®å€¼çš„æ ¼å¼æ­£ç¡®æ˜¾ç¤ºã€‚

### Q: å¦‚ä½•æ·»åŠ æ–°çš„æ•°æ®æºï¼Ÿ
A: ä¿®æ”¹DataManagerç±»ä¸­çš„download_stock_dataæ–¹æ³•ï¼Œæ”¯æŒä¸åŒçš„æ•°æ®æºã€‚

### Q: æŠ¥å‘Šæ²¡æœ‰è‡ªåŠ¨æ‰“å¼€ï¼Ÿ
A: æ£€æŸ¥æµè§ˆå™¨è®¾ç½®ï¼Œæˆ–æ‰‹åŠ¨æ‰“å¼€ç”Ÿæˆçš„HTMLæ–‡ä»¶ã€‚

## ðŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ï¼Œè¯¦è§LICENSEæ–‡ä»¶ã€‚

## ðŸ¤ è´¡çŒ®

æ¬¢è¿Žæäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ï¼

## ðŸ“ž è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š
- æäº¤GitHub Issue
- å‘é€é‚®ä»¶è‡³é¡¹ç›®ç»´æŠ¤è€…

---

**æœ€åŽæ›´æ–°**ï¼š2024å¹´12æœˆ

**ç‰ˆæœ¬**ï¼šv2.0.0 