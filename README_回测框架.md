# Backtrader å›žæµ‹æ¡†æž¶

è¿™æ˜¯ä¸€ä¸ªåŸºäºŽ Backtrader åŒ…æž„å»ºçš„å®Œæ•´å›žæµ‹æ¡†æž¶ï¼ŒåŒ…å«æ•°æ®å±‚ã€ç­–ç•¥é€»è¾‘å±‚ã€æ‰§è¡Œå±‚ã€é£Žé™©æŽ§åˆ¶å±‚å’Œè¯„ä¼°å±‚ã€‚

## åŠŸèƒ½ç‰¹æ€§

### ðŸ“Š æ•°æ®å±‚
- **åŽ†å²è¡Œæƒ…æ•°æ®èŽ·å–**ï¼šé€šè¿‡ xtquant æŽ¥å£èŽ·å–è‚¡ç¥¨åŽ†å²æ•°æ®
- **æ•°æ®æ¸…æ´—**ï¼šè‡ªåŠ¨å¤„ç†ç¼ºå¤±å€¼ã€å¼‚å¸¸å€¼ã€é‡å¤æ•°æ®
- **åŸºæœ¬é¢æ•°æ®**ï¼šé¢„ç•™æŽ¥å£ï¼Œå¯æ‰©å±•èŽ·å–è´¢åŠ¡æ•°æ®
- **äº‹ä»¶æ•°æ®**ï¼šé¢„ç•™æŽ¥å£ï¼Œå¯æ‰©å±•èŽ·å–å…¬å‘Šã€æ–°é—»ç­‰äº‹ä»¶æ•°æ®

### ðŸ§  ç­–ç•¥é€»è¾‘å±‚
- **ä¿¡å·ç”Ÿæˆ**ï¼šå¤šç§æŠ€æœ¯æŒ‡æ ‡ç»„åˆç”Ÿæˆäº¤æ˜“ä¿¡å·
- **ä»“ä½è®¡ç®—**ï¼šåŸºäºŽé£Žé™©ç®¡ç†çš„ä»“ä½åˆ†é…ç®—æ³•
- **äº¤æ˜“è§„åˆ™**ï¼šå®Œæ•´çš„ä¹°å…¥ã€å–å‡ºã€æ­¢æŸã€æ­¢ç›ˆé€»è¾‘

### âš¡ æ‰§è¡Œå±‚
- **äº¤æ˜“æˆæœ¬æ¨¡æ‹Ÿ**ï¼šæ‰‹ç»­è´¹ã€æ»‘ç‚¹ã€å°èŠ±ç¨Žç­‰çœŸå®žäº¤æ˜“æˆæœ¬
- **æµåŠ¨æ€§é™åˆ¶**ï¼šæœ€å°äº¤æ˜“é‡‘é¢ã€äº¤æ˜“é‡é™åˆ¶
- **è®¢å•æ‰§è¡Œ**ï¼šæ¨¡æ‹ŸçœŸå®žå¸‚åœºçŽ¯å¢ƒä¸‹çš„è®¢å•æ‰§è¡Œ

### ðŸ›¡ï¸ é£Žé™©æŽ§åˆ¶å±‚
- **æ­¢æŸè§„åˆ™**ï¼šå¤šç§æ­¢æŸç­–ç•¥ï¼ˆå›ºå®šæ¯”ä¾‹ã€ç§»åŠ¨æ­¢æŸç­‰ï¼‰
- **ä»“ä½ä¸Šé™**ï¼šå•åªè‚¡ç¥¨æœ€å¤§ä»“ä½é™åˆ¶
- **é£Žé™©æŒ‡æ ‡ç›‘æŽ§**ï¼šVaRã€æœ€å¤§å›žæ’¤ã€æ³¢åŠ¨çŽ‡ç­‰é£Žé™©æŒ‡æ ‡
- **æ æ†æŽ§åˆ¶**ï¼šæœ€å¤§æ æ†é™åˆ¶

### ðŸ“ˆ è¯„ä¼°å±‚
- **ç»©æ•ˆæŒ‡æ ‡**ï¼šå¤æ™®æ¯”çŽ‡ã€å¹´åŒ–æ”¶ç›Šã€å¡çŽ›æ¯”çŽ‡ã€ç´¢æè¯ºæ¯”çŽ‡
- **é£Žé™©æŒ‡æ ‡**ï¼šæœ€å¤§å›žæ’¤ã€VaRã€æ³¢åŠ¨çŽ‡
- **äº¤æ˜“ç»Ÿè®¡**ï¼šèƒœçŽ‡ã€ç›ˆäºæ¯”ã€äº¤æ˜“æ¬¡æ•°
- **å¯è§†åŒ–**ï¼šæŠ•èµ„ç»„åˆä»·å€¼æ›²çº¿ã€å›žæ’¤æ›²çº¿ã€æ”¶ç›Šåˆ†å¸ƒå›¾

## å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

## å¿«é€Ÿå¼€å§‹

### 1. åŸºæœ¬ä½¿ç”¨

```python
from Choose.backtest import BacktestFramework, DataManager
from Choose.strategies import get_strategy_class

# åˆå§‹åŒ–æ•°æ®ç®¡ç†å™¨
data_manager = DataManager()

# èŽ·å–è‚¡ç¥¨æ•°æ®
stock_codes = ['000001.SZ', '000002.SZ', '000858.SZ']
data_dict = data_manager.download_stock_data(
  stock_codes,
  start_date='2023-01-01',
  end_date='2023-12-31'
)

# åˆ›å»ºå›žæµ‹æ¡†æž¶
framework = BacktestFramework(initial_cash=1000000)
framework.setup_cerebro()
framework.add_data(data_dict)

# æ·»åŠ ç­–ç•¥
strategy_class = get_strategy_class('momentum')
framework.add_strategy(strategy_class)

# è¿è¡Œå›žæµ‹
strategy, metrics = framework.run_backtest()
```

### 2. ä½¿ç”¨ç¤ºä¾‹è„šæœ¬

```bash
python example_usage.py
```

## å†…ç½®ç­–ç•¥

### 1. åŠ¨é‡ç­–ç•¥ (MomentumStrategy)
- **åŽŸç†**ï¼šåŸºäºŽä»·æ ¼åŠ¨é‡æŒ‡æ ‡è¿›è¡Œäº¤æ˜“
- **å‚æ•°**ï¼š
  - `lookback_period`: å›žçœ‹å‘¨æœŸ (é»˜è®¤: 20)
  - `momentum_threshold`: åŠ¨é‡é˜ˆå€¼ (é»˜è®¤: 0.05)
  - `position_size`: ä»“ä½å¤§å° (é»˜è®¤: 0.1)

### 2. ç§»åŠ¨å¹³å‡çº¿äº¤å‰ç­–ç•¥ (MACrossStrategy)
- **åŽŸç†**ï¼šå¿«çº¿ä¸Šç©¿æ…¢çº¿ä¹°å…¥ï¼Œä¸‹ç©¿å–å‡º
- **å‚æ•°**ï¼š
  - `fast_period`: å¿«é€Ÿå‡çº¿å‘¨æœŸ (é»˜è®¤: 10)
  - `slow_period`: æ…¢é€Ÿå‡çº¿å‘¨æœŸ (é»˜è®¤: 30)

### 3. RSIç­–ç•¥ (RSIStrategy)
- **åŽŸç†**ï¼šRSIè¶…å–ä¹°å…¥ï¼Œè¶…ä¹°å–å‡º
- **å‚æ•°**ï¼š
  - `rsi_period`: RSIå‘¨æœŸ (é»˜è®¤: 14)
  - `oversold`: è¶…å–é˜ˆå€¼ (é»˜è®¤: 30)
  - `overbought`: è¶…ä¹°é˜ˆå€¼ (é»˜è®¤: 70)

### 4. å¸ƒæž—å¸¦ç­–ç•¥ (BollingerBandsStrategy)
- **åŽŸç†**ï¼šä»·æ ¼çªç ´å¸ƒæž—å¸¦è¾¹ç•Œè¿›è¡Œäº¤æ˜“
- **å‚æ•°**ï¼š
  - `bb_period`: å¸ƒæž—å¸¦å‘¨æœŸ (é»˜è®¤: 20)
  - `bb_dev`: æ ‡å‡†å·®å€æ•° (é»˜è®¤: 2)

### 5. åŒè½¨çªç ´ç­–ç•¥ (DualThrustStrategy)
- **åŽŸç†**ï¼šåŸºäºŽä»·æ ¼çªç ´ä¸Šä¸‹è½¨è¿›è¡Œäº¤æ˜“
- **å‚æ•°**ï¼š
  - `lookback_period`: å›žçœ‹å‘¨æœŸ (é»˜è®¤: 20)
  - `k1`: ä¸Šè½¨ç³»æ•° (é»˜è®¤: 0.7)
  - `k2`: ä¸‹è½¨ç³»æ•° (é»˜è®¤: 0.7)

### 6. ç»„åˆç­–ç•¥ (PortfolioStrategy)
- **åŽŸç†**ï¼šç»“åˆå¤šä¸ªæŠ€æœ¯æŒ‡æ ‡çš„ç»¼åˆç­–ç•¥
- **ç‰¹ç‚¹**ï¼šåŒæ—¶è€ƒè™‘å‡çº¿ã€RSIã€å¸ƒæž—å¸¦ã€æˆäº¤é‡ç­‰å¤šä¸ªæŒ‡æ ‡

## é…ç½®è¯´æ˜Ž

### æ•°æ®é…ç½® (config.py)
```python
DATA_CONFIG = {
    'default_index': '000852.SH',  # é»˜è®¤æŒ‡æ•°
    'data_period': '1d',           # æ•°æ®å‘¨æœŸ
    'start_date': '2023-01-01',    # å›žæµ‹å¼€å§‹æ—¥æœŸ
    'end_date': '2023-12-31',      # å›žæµ‹ç»“æŸæ—¥æœŸ
    'max_stocks': 50,              # æœ€å¤§è‚¡ç¥¨æ•°é‡
}
```

### é£Žé™©æŽ§åˆ¶é…ç½®
```python
RISK_CONFIG = {
    'max_position_pct': 0.1,       # å•åªè‚¡ç¥¨æœ€å¤§ä»“ä½æ¯”ä¾‹
    'stop_loss_pct': 0.05,         # æ­¢æŸæ¯”ä¾‹
    'max_drawdown_pct': 0.2,       # æœ€å¤§å›žæ’¤é™åˆ¶
    'var_confidence': 0.95,        # VaRç½®ä¿¡åº¦
}
```

### äº¤æ˜“æˆæœ¬é…ç½®
```python
TRANSACTION_CONFIG = {
    'commission_pct': 0.0003,      # æ‰‹ç»­è´¹çŽ‡
    'slippage_pct': 0.0001,        # æ»‘ç‚¹çŽ‡
    'min_trade_amount': 1000,      # æœ€å°äº¤æ˜“é‡‘é¢
    'stamp_duty': 0.001,           # å°èŠ±ç¨Ž
}
```

## é«˜çº§åŠŸèƒ½

### 1. å¤šç­–ç•¥å¯¹æ¯”

```python
from Choose.example_usage import run_multiple_strategies_comparison

results = run_multiple_strategies_comparison(
  strategy_names=['momentum', 'ma_cross', 'rsi'],
  stock_codes=['000001.SZ', '000002.SZ', '000858.SZ'],
  start_date='2023-01-01',
  end_date='2023-12-31'
)
```

### 2. å‚æ•°ä¼˜åŒ–

```python
from Choose.example_usage import run_parameter_optimization

param_ranges = {
  'lookback_period': [10, 15, 20, 25],
  'momentum_threshold': [0.03, 0.05, 0.07],
  'position_size': [0.05, 0.1, 0.15]
}

results = run_parameter_optimization(
  strategy_name='momentum',
  param_ranges=param_ranges,
  stock_codes=['000001.SZ', '000002.SZ']
)
```

### 3. è‡ªå®šä¹‰ç­–ç•¥
```python
import backtrader as bt

class MyCustomStrategy(bt.Strategy):
    params = (
        ('my_param', 10),
    )
    
    def __init__(self):
        # åˆå§‹åŒ–æŒ‡æ ‡
        self.my_indicator = bt.indicators.SimpleMovingAverage(
            self.data.close, period=self.params.my_param
        )
    
    def next(self):
        # å®žçŽ°äº¤æ˜“é€»è¾‘
        if self.my_indicator[0] > self.data.close[0]:
            self.buy()
        elif self.my_indicator[0] < self.data.close[0]:
            self.sell()
```

## è¾“å‡ºç»“æžœ

### 1. æŽ§åˆ¶å°è¾“å‡º
```
å›žæµ‹ç»©æ•ˆåˆ†æžæŠ¥å‘Š
==================================================
æ€»æ”¶ç›ŠçŽ‡: 15.23%
å¹´åŒ–æ”¶ç›ŠçŽ‡: 12.45%
æ€»äº¤æ˜“æ¬¡æ•°: 156
èƒœçŽ‡: 58.33%
å¹³å‡ç›ˆåˆ©: 2.34%
å¹³å‡äºæŸ: -1.67%
ç›ˆäºæ¯”: 1.40
å¤æ™®æ¯”çŽ‡: 1.25
ç´¢æè¯ºæ¯”çŽ‡: 1.45
å¡çŽ›æ¯”çŽ‡: 2.34
æœ€å¤§å›žæ’¤: -5.32%
VaR(95%): -2.15%
==================================================
```

### 2. å›¾è¡¨è¾“å‡º
- æŠ•èµ„ç»„åˆä»·å€¼æ›²çº¿
- äº¤æ˜“ç›ˆäºåˆ†å¸ƒå›¾
- ç´¯è®¡ç›ˆäºæ›²çº¿
- å›žæ’¤æ›²çº¿

### 3. æ–‡ä»¶è¾“å‡º
- JSONæ ¼å¼çš„è¯¦ç»†å›žæµ‹ç»“æžœ
- CSVæ ¼å¼çš„ç­–ç•¥å¯¹æ¯”æŠ¥å‘Š
- CSVæ ¼å¼çš„å‚æ•°ä¼˜åŒ–æŠ¥å‘Š

## æ³¨æ„äº‹é¡¹

1. **æ•°æ®èŽ·å–**ï¼šç¡®ä¿ xtquant æŽ¥å£æ­£å¸¸å·¥ä½œï¼ŒMiniQmt å·²è¿žæŽ¥
2. **å†…å­˜ä½¿ç”¨**ï¼šå¤§é‡è‚¡ç¥¨æ•°æ®å¯èƒ½å ç”¨è¾ƒå¤šå†…å­˜ï¼Œå»ºè®®åˆ†æ‰¹å¤„ç†
3. **è®¡ç®—æ—¶é—´**ï¼šå‚æ•°ä¼˜åŒ–å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œå»ºè®®ä½¿ç”¨å°è§„æ¨¡æµ‹è¯•
4. **é£Žé™©æŽ§åˆ¶**ï¼šå®žé™…äº¤æ˜“ä¸­è¯·æ ¹æ®å¸‚åœºæƒ…å†µè°ƒæ•´é£Žé™©å‚æ•°

## æ‰©å±•å¼€å‘

### æ·»åŠ æ–°ç­–ç•¥
1. åœ¨ `strategies.py` ä¸­å®šä¹‰æ–°çš„ç­–ç•¥ç±»
2. ç»§æ‰¿ `bt.Strategy` å¹¶å®žçŽ° `__init__` å’Œ `next` æ–¹æ³•
3. åœ¨ `STRATEGY_REGISTRY` ä¸­æ³¨å†Œæ–°ç­–ç•¥

### æ·»åŠ æ–°æŒ‡æ ‡
1. ä½¿ç”¨ Backtrader å†…ç½®æŒ‡æ ‡æˆ–è‡ªå®šä¹‰æŒ‡æ ‡
2. åœ¨ç­–ç•¥çš„ `__init__` æ–¹æ³•ä¸­åˆå§‹åŒ–æŒ‡æ ‡
3. åœ¨ `next` æ–¹æ³•ä¸­ä½¿ç”¨æŒ‡æ ‡ç”Ÿæˆäº¤æ˜“ä¿¡å·

### æ·»åŠ æ–°åˆ†æžå™¨
1. ç»§æ‰¿ `PerformanceAnalyzer` ç±»
2. å®žçŽ°æ–°çš„åˆ†æžæ–¹æ³•
3. åœ¨ `BacktestFramework` ä¸­é›†æˆæ–°åˆ†æžå™¨

## æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æŸ¥çœ‹ï¼š
1. Backtrader å®˜æ–¹æ–‡æ¡£
2. xtquant æŽ¥å£æ–‡æ¡£
3. ä»£ç æ³¨é‡Šå’Œç¤ºä¾‹

## æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-01-01)
- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- æ”¯æŒ6ç§å†…ç½®ç­–ç•¥
- å®Œæ•´çš„é£Žé™©æŽ§åˆ¶å’Œç»©æ•ˆè¯„ä¼°
- å¤šç­–ç•¥å¯¹æ¯”å’Œå‚æ•°ä¼˜åŒ–åŠŸèƒ½ 